..FF                                                                     [100%]
=================================== FAILURES ===================================
______________________________ test_metrics_json _______________________________

    def test_metrics_json():
        """Verify the metrics.json file contains correct aggregated data."""
        path = "/home/user/metrics.json"
        assert os.path.isfile(path), f"Metrics JSON file is missing: {path}"
    
        with open(path, 'r', encoding='utf-8') as f:
            try:
                metrics = json.load(f)
            except json.JSONDecodeError:
                assert False, f"Failed to parse JSON from {path}"
    
        assert "Total_USD_Revenue" in metrics, "Missing 'Total_USD_Revenue' key in metrics.json"
        assert "Top_Product" in metrics, "Missing 'Top_Product' key in metrics.json"
    
        expected_revenue = 4330.41
        actual_revenue = float(metrics["Total_USD_Revenue"])
>       assert abs(actual_revenue - expected_revenue) < 1.0, \
            f"Expected Total_USD_Revenue ~{expected_revenue}, but got {actual_revenue}"
E       AssertionError: Expected Total_USD_Revenue ~4330.41, but got 496.79
E       assert 3833.62 < 1.0
E        +  where 3833.62 = abs((496.79 - 4330.41))

test.py:34: AssertionError
_____________________________ test_daily_sales_csv _____________________________

    def test_daily_sales_csv():
        """Verify the daily_sales.csv file structure and values."""
        path = "/home/user/daily_sales.csv"
        assert os.path.isfile(path), f"Daily sales CSV is missing: {path}"
    
        with open(path, 'r', encoding='utf-8') as f:
            reader = csv.DictReader(f)
            fieldnames = reader.fieldnames
            assert fieldnames is not None, "daily_sales.csv is empty or has no header"
    
            expected_columns = ['Date', 'Daily_Revenue', 'Rolling_7d_Revenue']
            assert list(fieldnames) == expected_columns, \
                f"Expected columns {expected_columns}, but got {fieldnames}"
    
            rows = list(reader)
    
>       assert len(rows) == 4, f"Expected 4 valid daily sales rows, but got {len(rows)}"
E       AssertionError: Expected 4 valid daily sales rows, but got 5
E       assert 5 == 4
E        +  where 5 = len([{'Daily_Revenue': '163.16', 'Date': '2023-01-01', 'Rolling_7d_Revenue': '163.16'}, {'Daily_Revenue': '3.85', 'Date': ...-04', 'Rolling_7d_Revenue': '41.75'}, {'Daily_Revenue': '329.79', 'Date': '2023-01-05', 'Rolling_7d_Revenue': '99.36'}])

test.py:58: AssertionError
=========================== short test summary info ============================
FAILED test.py::test_metrics_json - AssertionError: Expected Total_USD_Revenu...
FAILED test.py::test_daily_sales_csv - AssertionError: Expected 4 valid daily...
2 failed, 2 passed in 0.02s
