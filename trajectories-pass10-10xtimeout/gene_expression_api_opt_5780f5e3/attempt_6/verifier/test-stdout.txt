F                                                                        [100%]
=================================== FAILURES ===================================
___________________ test_notebook_execution_time_and_output ____________________

    def test_notebook_execution_time_and_output():
        notebook_path = '/home/user/fetch_data.ipynb'
        output_notebook_path = '/home/user/fetch_data_out.ipynb'
        output_csv_path = '/home/user/expression_data.csv'
    
        # Remove output CSV if it exists to ensure we are testing the new run
        if os.path.exists(output_csv_path):
            os.remove(output_csv_path)
    
        start_time = time.time()
    
        # Execute the notebook
        result = subprocess.run(
            [
                'jupyter', 'nbconvert',
                '--to', 'notebook',
                '--execute', notebook_path,
                '--output', output_notebook_path
            ],
            capture_output=True,
            text=True
        )
    
        duration = time.time() - start_time
    
        # Ensure notebook executed successfully
>       assert result.returncode == 0, f"Notebook execution failed: {result.stderr}"
E       AssertionError: Notebook execution failed: [NbConvertApp] Converting notebook /home/user/fetch_data.ipynb to notebook
E         Traceback (most recent call last):
E           File "/usr/local/bin/jupyter-nbconvert", line 8, in <module>
E             sys.exit(main())
E           File "/usr/local/lib/python3.10/dist-packages/jupyter_core/application.py", line 284, in launch_instance
E             super().launch_instance(argv=argv, **kwargs)
E           File "/usr/local/lib/python3.10/dist-packages/traitlets/config/application.py", line 1075, in launch_instance
E             app.start()
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 420, in start
E             self.convert_notebooks()
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 597, in convert_notebooks
E             self.convert_single_notebook(notebook_filename)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 563, in convert_single_notebook
E             output, resources = self.export_single_notebook(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 487, in export_single_notebook
E             output, resources = self.exporter.from_filename(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 201, in from_filename
E             return self.from_file(f, resources=resources, **kw)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 220, in from_file
E             return self.from_notebook_node(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/notebook.py", line 36, in from_notebook_node
E             nb_copy, resources = super().from_notebook_node(nb, resources, **kw)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 154, in from_notebook_node
E             nb_copy, resources = self._preprocess(nb_copy, resources)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 353, in _preprocess
E             nbc, resc = preprocessor(nbc, resc)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/base.py", line 48, in __call__
E             return self.preprocess(nb, resources)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/execute.py", line 103, in preprocess
E             self.preprocess_cell(cell, resources, index)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/execute.py", line 124, in preprocess_cell
E             cell = self.execute_cell(cell, index, store_history=True)
E           File "/usr/local/lib/python3.10/dist-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
E             return loop.run_until_complete(inner)
E           File "/usr/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
E             return future.result()
E           File "/usr/local/lib/python3.10/dist-packages/nbclient/client.py", line 1062, in async_execute_cell
E             await self._check_raise_for_error(cell, cell_index, exec_reply)
E           File "/usr/local/lib/python3.10/dist-packages/nbclient/client.py", line 918, in _check_raise_for_error
E             raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
E         nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
E         ------------------
E         
E         import pandas as pd
E         from concurrent.futures import ThreadPoolExecutor
E         from mock_api import get_expression_data
E         
E         def fetch_page(page):
E             res = get_expression_data(page)
E             if not isinstance(res, pd.DataFrame):
E                 res = pd.DataFrame(res)
E             return res
E         
E         pages = range(1, 21)
E         
E         with ThreadPoolExecutor(max_workers=20) as executor:
E             results = list(executor.map(fetch_page, pages))
E         
E         df = pd.concat(results, ignore_index=True)
E         df_sorted = df.sort_values('gene_id', ascending=True)
E         df_sorted.to_csv('/home/user/expression_data.csv', index=False)
E         
E         ------------------
E         
E         
E         [0;31m---------------------------------------------------------------------------[0m
E         [0;31mImportError[0m                               Traceback (most recent call last)
E         Cell [0;32mIn[1], line 3[0m
E         [1;32m      1[0m [38;5;28;01mimport[39;00m[38;5;250m [39m[38;5;21;01mpandas[39;00m[38;5;250m [39m[38;5;28;01mas[39;00m[38;5;250m [39m[38;5;21;01mpd[39;00m
E         [1;32m      2[0m [38;5;28;01mfrom[39;00m[38;5;250m [39m[38;5;21;01mconcurrent[39;00m[38;5;21;01m.[39;00m[38;5;21;01mfutures[39;00m[38;5;250m [39m[38;5;28;01mimport[39;00m ThreadPoolExecutor
E         [0;32m----> 3[0m [38;5;28;01mfrom[39;00m[38;5;250m [39m[38;5;21;01mmock_api[39;00m[38;5;250m [39m[38;5;28;01mimport[39;00m get_expression_data
E         [1;32m      5[0m [38;5;28;01mdef[39;00m[38;5;250m [39m[38;5;21mfetch_page[39m(page):
E         [1;32m      6[0m     res [38;5;241m=[39m get_expression_data(page)
E         
E         [0;31mImportError[0m: cannot import name 'get_expression_data' from 'mock_api' (/home/user/mock_api.py)
E         
E         
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['jupyter', 'nbconvert', '--to', 'notebook', '--execute', '/home/user/fetch_data.ipynb', '--outp...1b[0;31mImportError\x1b[0m: cannot import name \'get_expression_data\' from \'mock_api\' (/home/user/mock_api.py)\n\n').returncode

test.py:33: AssertionError
=========================== short test summary info ============================
FAILED test.py::test_notebook_execution_time_and_output - AssertionError: Not...
1 failed in 3.35s
