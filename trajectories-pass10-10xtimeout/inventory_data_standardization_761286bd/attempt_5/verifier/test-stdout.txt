FFF                                                                      [100%]
=================================== FAILURES ===================================
________________________ test_notebook_exists_and_runs _________________________

    def test_notebook_exists_and_runs():
        """Verify that the notebook exists and executes without error."""
        assert os.path.isfile(NOTEBOOK_PATH), f"Notebook missing at {NOTEBOOK_PATH}"
    
        # Remove existing outputs to ensure they are generated by this run
        if os.path.exists(OUTPUT_CSV_PATH):
            os.remove(OUTPUT_CSV_PATH)
        if os.path.exists(OUTPUT_JSON_PATH):
            os.remove(OUTPUT_JSON_PATH)
    
        result = subprocess.run(
            ["jupyter", "nbconvert", "--execute", "--to", "notebook", "--inplace", NOTEBOOK_PATH],
            capture_output=True,
            text=True
        )
    
>       assert result.returncode == 0, f"Notebook execution failed. Stderr: {result.stderr}"
E       AssertionError: Notebook execution failed. Stderr: [NbConvertApp] Converting notebook /home/user/standardize_data.ipynb to notebook
E         Traceback (most recent call last):
E           File "/usr/local/bin/jupyter-nbconvert", line 8, in <module>
E             sys.exit(main())
E           File "/usr/local/lib/python3.10/dist-packages/jupyter_core/application.py", line 284, in launch_instance
E             super().launch_instance(argv=argv, **kwargs)
E           File "/usr/local/lib/python3.10/dist-packages/traitlets/config/application.py", line 1075, in launch_instance
E             app.start()
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 420, in start
E             self.convert_notebooks()
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 597, in convert_notebooks
E             self.convert_single_notebook(notebook_filename)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 563, in convert_single_notebook
E             output, resources = self.export_single_notebook(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/nbconvertapp.py", line 487, in export_single_notebook
E             output, resources = self.exporter.from_filename(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 201, in from_filename
E             return self.from_file(f, resources=resources, **kw)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 220, in from_file
E             return self.from_notebook_node(
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/notebook.py", line 36, in from_notebook_node
E             nb_copy, resources = super().from_notebook_node(nb, resources, **kw)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 154, in from_notebook_node
E             nb_copy, resources = self._preprocess(nb_copy, resources)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/exporters/exporter.py", line 353, in _preprocess
E             nbc, resc = preprocessor(nbc, resc)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/base.py", line 48, in __call__
E             return self.preprocess(nb, resources)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/execute.py", line 103, in preprocess
E             self.preprocess_cell(cell, resources, index)
E           File "/usr/local/lib/python3.10/dist-packages/nbconvert/preprocessors/execute.py", line 124, in preprocess_cell
E             cell = self.execute_cell(cell, index, store_history=True)
E           File "/usr/local/lib/python3.10/dist-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
E             return loop.run_until_complete(inner)
E           File "/usr/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
E             return future.result()
E           File "/usr/local/lib/python3.10/dist-packages/nbclient/client.py", line 1062, in async_execute_cell
E             await self._check_raise_for_error(cell, cell_index, exec_reply)
E           File "/usr/local/lib/python3.10/dist-packages/nbclient/client.py", line 918, in _check_raise_for_error
E             raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
E         nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
E         ------------------
E         import pandas as pd
E         import numpy as np
E         import json
E         
E         # 2. Read the file
E         df = pd.read_csv('/home/user/raw_inventory.csv')
E         
E         # 3. Standardize column names
E         df.columns = df.columns.str.strip().str.lower().str.replace(' ', '_')
E         
E         # 4. Clean 'product_price'
E         price_str = df['product_price'].astype(str)
E         price_str = price_str.str.replace('$', '', regex=False).str.strip()
E         price_str = price_str.replace(['N/A', 'Unknown', 'nan', 'None', ''], np.nan)
E         df['product_price'] = pd.to_numeric(price_str, errors='coerce')
E         
E         # 5. Standardize 'date_added'
E         # Parse to datetime with format='mixed' to handle various formats
E         df['date_added'] = pd.to_datetime(df['date_added'].astype(str).str.strip(), format='mixed', errors='coerce')
E         # Format as YYYY-MM-DD
E         df['date_added'] = df['date_added'].dt.strftime('%Y-%m-%d')
E         
E         # 6. Ensure 'item_id' is integer
E         try:
E             df['item_id'] = pd.to_numeric(df['item_id']).astype('int64')
E         except ValueError:
E             df['item_id'] = pd.to_numeric(df['item_id'], errors='coerce').astype('Int64')
E         
E         # 7. Save cleaned DataFrame to CSV without index
E         df.to_csv('/home/user/clean_inventory.csv', index=False)
E         
E         # 8. Generate dictionary mapping column names to dtype strings
E         schema = df.dtypes.astype(str).to_dict()
E         with open('/home/user/schema_report.json', 'w') as f:
E             json.dump(schema, f, indent=4)
E         
E         
E         ------------------
E         
E         
E         [0;31m---------------------------------------------------------------------------[0m
E         [0;31mEmptyDataError[0m                            Traceback (most recent call last)
E         Cell [0;32mIn[1], line 6[0m
E         [1;32m      3[0m [38;5;28;01mimport[39;00m[38;5;250m [39m[38;5;21;01mjson[39;00m
E         [1;32m      5[0m [38;5;66;03m# 2. Read the file[39;00m
E         [0;32m----> 6[0m df [38;5;241m=[39m [43mpd[49m[38;5;241;43m.[39;49m[43mread_csv[49m[43m([49m[38;5;124;43m'[39;49m[38;5;124;43m/home/user/raw_inventory.csv[39;49m[38;5;124;43m'[39;49m[43m)[49m
E         [1;32m      8[0m [38;5;66;03m# 3. Standardize column names[39;00m
E         [1;32m      9[0m df[38;5;241m.[39mcolumns [38;5;241m=[39m df[38;5;241m.[39mcolumns[38;5;241m.[39mstr[38;5;241m.[39mstrip()[38;5;241m.[39mstr[38;5;241m.[39mlower()[38;5;241m.[39mstr[38;5;241m.[39mreplace([38;5;124m'[39m[38;5;124m [39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124m_[39m[38;5;124m'[39m)
E         
E         File [0;32m/usr/local/lib/python3.10/dist-packages/pandas/io/parsers/readers.py:1026[0m, in [0;36mread_csv[0;34m(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)[0m
E         [1;32m   1013[0m kwds_defaults [38;5;241m=[39m _refine_defaults_read(
E         [1;32m   1014[0m     dialect,
E         [1;32m   1015[0m     delimiter,
E         [0;32m   (...)[0m
E         [1;32m   1022[0m     dtype_backend[38;5;241m=[39mdtype_backend,
E         [1;32m   1023[0m )
E         [1;32m   1024[0m kwds[38;5;241m.[39mupdate(kwds_defaults)
E         [0;32m-> 1026[0m [38;5;28;01mreturn[39;00m [43m_read[49m[43m([49m[43mfilepath_or_buffer[49m[43m,[49m[43m [49m[43mkwds[49m[43m)[49m
E         
E         File [0;32m/usr/local/lib/python3.10/dist-packages/pandas/io/parsers/readers.py:620[0m, in [0;36m_read[0;34m(filepath_or_buffer, kwds)[0m
E         [1;32m    617[0m _validate_names(kwds[38;5;241m.[39mget([38;5;124m"[39m[38;5;124mnames[39m[38;5;124m"[39m, [38;5;28;01mNone[39;00m))
E         [1;32m    619[0m [38;5;66;03m# Create the parser.[39;00m
E         [0;32m--> 620[0m parser [38;5;241m=[39m [43mTextFileReader[49m[43m([49m[43mfilepath_or_buffer[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
E         [1;32m    622[0m [38;5;28;01mif[39;00m chunksize [38;5;129;01mor[39;00m iterator:
E         [1;32m    623[0m     [38;5;28;01mreturn[39;00m parser
E         
E         File [0;32m/usr/local/lib/python3.10/dist-packages/pandas/io/parsers/readers.py:1620[0m, in [0;36mTextFileReader.__init__[0;34m(self, f, engine, **kwds)[0m
E         [1;32m   1617[0m     [38;5;28mself[39m[38;5;241m.[39moptions[[38;5;124m"[39m[38;5;124mhas_index_names[39m[38;5;124m"[39m] [38;5;241m=[39m kwds[[38;5;124m"[39m[38;5;124mhas_index_names[39m[38;5;124m"[39m]
E         [1;32m   1619[0m [38;5;28mself[39m[38;5;241m.[39mhandles: IOHandles [38;5;241m|[39m [38;5;28;01mNone[39;00m [38;5;241m=[39m [38;5;28;01mNone[39;00m
E         [0;32m-> 1620[0m [38;5;28mself[39m[38;5;241m.[39m_engine [38;5;241m=[39m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43m_make_engine[49m[43m([49m[43mf[49m[43m,[49m[43m [49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mengine[49m[43m)[49m
E         
E         File [0;32m/usr/local/lib/python3.10/dist-packages/pandas/io/parsers/readers.py:1898[0m, in [0;36mTextFileReader._make_engine[0;34m(self, f, engine)[0m
E         [1;32m   1895[0m     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(msg)
E         [1;32m   1897[0m [38;5;28;01mtry[39;00m:
E         [0;32m-> 1898[0m     [38;5;28;01mreturn[39;00m [43mmapping[49m[43m[[49m[43mengine[49m[43m][49m[43m([49m[43mf[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43moptions[49m[43m)[49m
E         [1;32m   1899[0m [38;5;28;01mexcept[39;00m [38;5;167;01mException[39;00m:
E         [1;32m   1900[0m     [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39mhandles [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
E         
E         File [0;32m/usr/local/lib/python3.10/dist-packages/pandas/io/parsers/c_parser_wrapper.py:93[0m, in [0;36mCParserWrapper.__init__[0;34m(self, src, **kwds)[0m
E         [1;32m     90[0m [38;5;28;01mif[39;00m kwds[[38;5;124m"[39m[38;5;124mdtype_backend[39m[38;5;124m"[39m] [38;5;241m==[39m [38;5;124m"[39m[38;5;124mpyarrow[39m[38;5;124m"[39m:
E         [1;32m     91[0m     [38;5;66;03m# Fail here loudly instead of in cython after reading[39;00m
E         [1;32m     92[0m     import_optional_dependency([38;5;124m"[39m[38;5;124mpyarrow[39m[38;5;124m"[39m)
E         [0;32m---> 93[0m [38;5;28mself[39m[38;5;241m.[39m_reader [38;5;241m=[39m [43mparsers[49m[38;5;241;43m.[39;49m[43mTextReader[49m[43m([49m[43msrc[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
E         [1;32m     95[0m [38;5;28mself[39m[38;5;241m.[39munnamed_cols [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_reader[38;5;241m.[39munnamed_cols
E         [1;32m     97[0m [38;5;66;03m# error: Cannot determine type of 'names'[39;00m
E         
E         File [0;32mpandas/_libs/parsers.pyx:581[0m, in [0;36mpandas._libs.parsers.TextReader.__cinit__[0;34m()[0m
E         
E         [0;31mEmptyDataError[0m: No columns to parse from file
E         
E         
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['jupyter', 'nbconvert', '--execute', '--to', 'notebook', '--inplace', '/home/user/standardize_d...parsers.TextReader.__cinit__\x1b[0;34m()\x1b[0m\n\n\x1b[0;31mEmptyDataError\x1b[0m: No columns to parse from file\n\n').returncode

test.py:41: AssertionError
_________________ test_clean_inventory_csv_exists_and_correct __________________

    def test_clean_inventory_csv_exists_and_correct():
        """Verify the cleaned CSV is correctly formatted."""
>       assert os.path.isfile(OUTPUT_CSV_PATH), f"Cleaned CSV missing at {OUTPUT_CSV_PATH}"
E       AssertionError: Cleaned CSV missing at /home/user/clean_inventory.csv
E       assert False
E        +  where False = <function isfile at 0x79d3f2dc9f30>('/home/user/clean_inventory.csv')
E        +    where <function isfile at 0x79d3f2dc9f30> = <module 'posixpath' from '/usr/lib/python3.10/posixpath.py'>.isfile
E        +      where <module 'posixpath' from '/usr/lib/python3.10/posixpath.py'> = os.path

test.py:45: AssertionError
__________________ test_schema_report_json_exists_and_correct __________________

    def test_schema_report_json_exists_and_correct():
        """Verify the schema report JSON is correctly formatted."""
>       assert os.path.isfile(OUTPUT_JSON_PATH), f"Schema JSON missing at {OUTPUT_JSON_PATH}"
E       AssertionError: Schema JSON missing at /home/user/schema_report.json
E       assert False
E        +  where False = <function isfile at 0x79d3f2dc9f30>('/home/user/schema_report.json')
E        +    where <function isfile at 0x79d3f2dc9f30> = <module 'posixpath' from '/usr/lib/python3.10/posixpath.py'>.isfile
E        +      where <module 'posixpath' from '/usr/lib/python3.10/posixpath.py'> = os.path

test.py:57: AssertionError
=========================== short test summary info ============================
FAILED test.py::test_notebook_exists_and_runs - AssertionError: Notebook exec...
FAILED test.py::test_clean_inventory_csv_exists_and_correct - AssertionError:...
FAILED test.py::test_schema_report_json_exists_and_correct - AssertionError: ...
3 failed in 5.72s
